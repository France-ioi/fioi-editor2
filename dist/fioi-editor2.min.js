!function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};e[a][0].call(d.exports,function(t){var n=e[a][1][t];return o(n?n:t)},d,d.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){e.exports=function(t,e){var n=e||document;if(n.createStyleSheet){var i=n.createStyleSheet();return i.cssText=t,i.ownerNode}var o=n.getElementsByTagName("head")[0],r=n.createElement("style");return r.type="text/css",r.styleSheet?r.styleSheet.cssText=t:r.appendChild(n.createTextNode(t)),o.appendChild(r),r},e.exports.byUrl=function(t){if(document.createStyleSheet)return document.createStyleSheet(t).ownerNode;var e=document.getElementsByTagName("head")[0],n=document.createElement("link");return n.rel="stylesheet",n.href=t,e.appendChild(n),n}},{}],2:[function(t,e,n){e.exports='<div><div ui-ace="{onLoad: vm.aceLoaded}"></div><div><span>Language du fichier :</span><select ng-model="vm.language" ng-options="option as option.label for option in vm.languageOptions track by option.id" ng-change="vm.languageChanged()"></select></div></div>'},{}],3:[function(t,e,n){"use strict";e.exports=function(e){function n(){return{restrict:"E",scope:{buffer:"@",onInit:"&"},template:t("./buffer.jade"),controllerAs:"vm",bindToController:!0,require:"^fioiEditor2",replace:!0,controller:i,link:function(t,e,n,i){t.$on("$destroy",function(){t.vm.cleanup()})}}}function i(t,e){function n(){i(f)}function i(t){d.languageOptions=t.getLanguages(),d.language=_.find(d.languageOptions,function(e){return e.id==t.language}),l&&(d.language&&"object"==typeof d.language&&l.session.setMode("ace/mode/"+d.language.ace.mode),l.setValue(t.text),l.selection.setRange(t.selection))}function o(){return{text:l.getValue(),language:d.language&&d.language.id,selection:l.selection.getRange()}}function r(){l.focus()}function a(t,e,n,i,o){var r={action:"insert",start:{row:t,column:e},end:{row:n,column:i},lines:o};l.session.doc.applyDeltas([r])}function s(t,e,n,i){var o={action:"remove",start:{row:t,column:e},end:{row:n,column:i}};l.session.doc.applyDeltas([o])}function u(t,e){l.selection.setRange({start:{row:t,column:e},end:{row:t,column:e}})}function c(t,e,n,i){l.selection.setRange({start:{row:t,column:e},end:{row:n,column:i}})}var d=this,l=null,f=e.get(this.buffer);n();var p=[t.on("update",n)];this.cleanup=function(){_.each(p,function(t){t()}),f.pullFromControl(),f.detachControl()},this.aceLoaded=function(t){l=t,l.$blockScrolling=1/0,l.commands.removeCommand("gotoline"),f.attachControl({load:i,dump:o,focus:r,insertLines:a,deleteLines:s,moveCursor:u,setSelection:c}),f.pushToControl(),l.focus(),l.session.doc.on("change",function(t){"insert"===t.action?f.logInsert(t.start.row,t.start.column,t.end.row,t.end.column,t.lines):f.logDelete(t.start.row,t.start.column,t.end.row,t.end.column)},!0),l.selection.addEventListener("changeCursor",function(){if(l.selection.isEmpty()){var t=l.selection.getRange();f.logCursor(t.start.row,t.start.column)}},!0),l.selection.addEventListener("changeSelection",function(){var t=l.selection.getRange();f.logSelect(t.start.row,t.start.column,t.end.row,t.end.column)},!0)},this.languageChanged=function(){f.pullFromControl(),f.pushToControl(),l.focus()}}e.directive("fioiEditor2Buffer",n),i.$inject=["FioiEditor2Signals","FioiEditor2Buffers"]}},{"./buffer.jade":2}],4:[function(t,e,n){e.exports='<div class="fioi-editor2"><ul class="fioi-editor2_tabs"><li ng-click="vm.addTab()" class="fioi-editor2_new-tab">+</li><li ng-repeat="tab in vm.tabs track by tab.id" ng-class="{\'active\':tab.id===vm.tab.id}" ng-click="vm.selectTab(tab)" class="fioi-editor2_tab"><span class="fioi-editor2_tab-title">{{tab.title}}</span><span ng-click="vm.closeTab(tab)" class="fioi-editor2_close-tab">Ã—</span></li></ul><div class="fioi-editor2_buffers"><div ng-repeat="buffer in vm.tab.buffers track by buffer"><fioi-editor2-buffer buffer="{{::buffer}}"></fioi-editor2-buffer></div></div></div>'},{}],5:[function(t,e,n){"use strict";e.exports=function(e){function n(e){return{restrict:"A",scope:{fioiEditor2:"&"},template:t("./editor.jade"),controllerAs:"vm",bindToController:!0,replace:!0,controller:i,link:function(t,n,i,o){function r(){t.$apply(function(){t.vm.update()})}var a=e.on("update",r);t.$on("$destroy",function(){a()}),t.vm.update()}}}function i(t){var e=this.fioiEditor2(),n=t.find(e.tabset),i=this;this.addTab=function(){var t=n.addTab();t.addBuffer(""),this.selectTab(t)}.bind(this),this.closeTab=function(t){n.removeTab(t.id)},this.selectTab=function(t){n.update({activeTabId:t.id})},this.update=function(){n=t.find(e.tabset),i.tabs=_.map(n.getTabs(),function(t){return{id:t.id,title:t.title}});var o=n.getActiveTab();i.tab={id:o.id,title:o.title,buffers:o.buffers}}}e.directive("fioiEditor2",n),n.$inject=["FioiEditor2Signals"],i.$inject=["FioiEditor2Tabsets"]}},{"./editor.jade":4}],6:[function(t,e,n){var i=".fioi-editor2 {\n   width: 762px;\n}\n\nul.fioi-editor2_tabs {\n   font: bold 11px Verdana, Arial, sans-serif;\n   list-style-type: none;\n   padding-bottom: 24px;\n   border-bottom: 1px solid #CCCCCC;\n   margin: 0;\n}\n\nul.fioi-editor2_tabs > li {\n   float: left;\n   height: 21px;\n   line-height: 21px;\n   padding: 0 7px;\n   background-color: #E0F3DB;\n   margin: 2px 2px 0 2px;\n   border: 1px solid #CCCCCC;\n   cursor: pointer;\n}\n\nul.fioi-editor2_tabs > li.active {\n   border-bottom: 1px solid #fff;\n   background-color: #FFFFFF;\n}\n\nul.fioi-editor2_tabs > li:hover .fioi-editor2_tab-title {\n   text-decoration: underline;\n}\n\n.fioi-editor2_close-tab {\n   padding: 0px 2px;\n   margin-left: 2px;\n   border-radius: 3px;\n}\n\n.fioi-editor2_close-tab:hover {\n   background-color: #D8D8D8;\n}\n\n.fioi-editor2_buffers {\n   width: 100%;\n}\n\n.fioi-editor2_buffers textarea {\n   width: 756px;\n   height: auto;\n   text-align: left;\n   border: 1px solid #CCCCCC;\n   border-top: none;\n}\n\n.fioi-editor2_buffers .ace_editor {\n   width: 760px;\n   height: 350px; /* 14px * 25 lines */\n   border: 1px solid #CCCCCC;\n   border-top: none;\n}\n\n/*\n#sourcesEditor {\n   width:762px;\n}\n\n#testsEditor {\n   width:762px;\n}\n\n.CodeMirror {\n  text-align: left;\n  border: 1px solid #CCCCCC;\n  border-top: none;\n}\n\n.CodeMirror.basic {\n  border-top: 1px solid #CCCCCC;\n}\n\n.tooltip {\n   display:none;\n}\n*/";t("./../node_modules/cssify")(i),e.exports=i},{"./../node_modules/cssify":1}],7:[function(t,e,n){"use strict";define(["angular","lodash","angular-ui-ace"],function(e,n){t("./main.css");var i=e.module("fioi-editor2",["ui.ace"]);t("./services/signals")(i),t("./services/recorder")(i),t("./services/tabsets")(i),t("./services/tabs")(i),t("./services/buffers")(i),t("./directives/editor")(i),t("./directives/buffer")(i)})},{"./directives/buffer":3,"./directives/editor":5,"./main.css":6,"./services/buffers":8,"./services/recorder":9,"./services/signals":10,"./services/tabs":11,"./services/tabsets":12}],8:[function(t,e,n){"use strict";e.exports=function(t){function e(t){function e(t){this.id=t,this.text="",this.selection={start:{row:0,column:0},end:{row:0,column:0}},this.languages=null,this.language=null,this.control=null}var n={},i={};return n.add=function(n){var o=t.freshId("b",n),r=i[o]=new e(o);return t.register(o,r),r},n.remove=function(t){var e=i[t];e&&delete i[t]},n.get=function(t){return i[t]},e.prototype.dump=function(){return{text:this.text,language:this.language,selection:this.selection}},e.prototype.load=function(t){return this.update(t),this},e.prototype.update=function(t,e){return"tab"in t&&(this.tab=t.tab),"languages"in t&&(this.languages=t.languages),"text"in t&&(this.text=t.text),"language"in t&&(this.language=t.language),"selection"in t&&(this.selection=_.clone(t.selection)),e||this.pushToControl(),this},e.prototype.getLanguages=function(){return this.languages?this.languages:this.tab.getLanguages()},e.prototype.attachControl=function(t){return this.control=t,this},e.prototype.detachControl=function(){return this.control=null,this},e.prototype.pushToControl=function(){return this.control&&this.control.load(this),this},e.prototype.pullFromControl=function(){return this.control&&this.update(this.control.dump(),!0),this},e.prototype.recordEvent=function(e){e.unshift(this.id),t.addEvent(e)},e.prototype.logInsert=function(e,n,i,o,r){t.addEvent([this.id,"i",e,n,i,o].concat(r))},e.prototype.logDelete=function(e,n,i,o){t.addEvent([this.id,"d",e,n,i,o])},e.prototype.logCursor=function(e,n){t.addEvent([this.id,"c",e,n])},e.prototype.logSelect=function(e,n,i,o){t.addEvent([this.id,"s",e,n,i,o])},e.prototype.focus=function(){this.control&&this.control.focus()},e.prototype.replayEvent=function(t){var e=this.control;if(e)switch(t[2]){case"c":e.moveCursor(t[3],t[4]);break;case"i":e.insertLines(t[3],t[4],t[5],t[6],t.slice(7));break;case"d":e.deleteLines(t[3],t[4],t[5],t[6]);break;case"s":e.setSelection(t[3],t[4],t[5],t[6]);break;default:console.log("Buffer ignored event",t[2])}},n}t.factory("FioiEditor2Buffers",e),e.$inject=["FioiEditor2Recorder"]}},{}],9:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e){function n(){for(var n=o.playCursor,r=Math.floor(Date.now()-o.startTime-o.playOffset),a=0,s=o.recording.events;n<s.length&&r>=a;){var u=s[n];a+=u[0];var c=u[1],d=u[2];try{c in o.targets&&o.targets[c].replayEvent(u),""===c&&"0"===d&&(o.targets={},o.options.loadState(u[3]),e.emitUpdate()),"function"==typeof o.options.replayEvent&&o.options.replayEvent(u),n+=1}catch(l){console.log("An exception occurred!",l),o.exception=l,i.pause();break}}o.playOffset+=a,o.playCursor=n,n==s.length&&(t.cancel(o.playInterval),o.playInterval=null,i.stop())}var i={},o={isRecording:!1,isPlaying:!1,isPaused:!1,segments:void 0,events:void 0,startTime:void 0,timeOffset:void 0,currentFrameTime:void 0,playInterval:void 0,playOffset:void 0,playCursor:void 0,options:null,nextFreshId:1,renaming:{},targets:{}};return i.record=function(t){return o.isPlaying||o.isRecording?!1:(o.isPaused=!1,o.options=t,o.isRecording=!0,o.timeOffset=0,o.startTime=Date.now(),o.playOffset=0,o.events=[[0,"","0",o.options.dumpState()]],void(o.segments=[]))},i.play=function(e,i){return o.isRecording||o.isPlaying?!1:(o.isPlaying=!0,o.recording=e,o.options=i,o.playCursor=0,o.startTime=Date.now(),o.playOffset=0,void(o.playInterval=t(n,20)))},i.pause=function(){if(o.isPaused)return!1;if(o.isRecording){var e=Date.now()-o.startTime;return o.timeOffset+=e,o.segments.push({duration:e,events:o.events}),o.events=void 0,o.startTime=void 0,o.isPaused=!0,!0}return o.isPlaying?(t.cancel(o.playInterval),o.playInterval=null,o.isPaused=!0,!0):!1},i.resume=function(){return o.isPaused?o.isRecording?(o.isPaused=!1,o.startTime=Date.now(),o.events=[[0,"","0",o.options.dumpState()]],!0):void(o.isPlaying&&(o.isPaused=!1,o.startTime=Date.now(),o.playOffset=0,o.playInterval=t(n,20))):!1},i.stop=function(){if(o.isRecording){o.isPaused||i.pause();var t=0,e=[];_.each(o.segments,function(n){t+=n.duration,Array.prototype.push.apply(e,n.events)});var n={duration:t,events:e};return o.isRecording=!1,o.segments=void 0,o.options=null,n}return o.isPlaying?(o.isPaused||i.pause(),o.events=void 0,void(o.options=null)):!1},i.register=function(t,e){t in o.renaming&&(t=o.renaming[t],o.targets[t]=e)},i.addEvent=function(t){if(o.isRecording){"number"!=typeof o.currentFrameTime&&(o.currentFrameTime=Math.floor(Date.now()-o.startTime),window.requestAnimationFrame(function(){o.currentFrameTime=void 0}));var e=o.currentFrameTime-o.playOffset;o.playOffset=o.currentFrameTime,t.unshift(e),o.events.push(t)}},i.freshId=function(t,e){var n=t.toString()+o.nextFreshId;return o.nextFreshId+=1,"string"==typeof e&&(o.renaming[n]=e),n},i}t.factory("FioiEditor2Recorder",e),e.$inject=["$interval","FioiEditor2Signals"]}},{}],10:[function(t,e,n){"use strict";e.exports=function(t){function e(t){function e(t){o[t]||(o[t]=!0,r=!0,s||a||(a=!0,window.requestAnimationFrame(n)))}function n(){var e=o;o={},r=!1,a=!1,e.update&&t.$emit("fioi-editor2_update")}var i={},o={},r=!1,a=!1,s=!1;return i.on=function(e,n){return t.$on("fioi-editor2_"+e,n)},i.defer=function(t){s=t,r&&!a&&n()},i.emitUpdate=function(){e("update")},i}t.factory("FioiEditor2Signals",e),e.$inject=["$rootScope"]}},{}],11:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e,n){function i(t){this.id=t,this.title="Tab",this.buffers=[],this.languages=null,this.defaultLanguage=null}var o={},r={};return o.add=function(e){var o=n.freshId("t",e),a=r[o]=new i(o);return n.register(o,a),t.emitUpdate(),a},o.remove=function(e){var n=r[e];n.clear(),delete r[e],t.emitUpdate()},o.get=function(t){return r[t]},i.prototype.update=function(e){return"tabset"in e&&(this.tabset=e.tabset),"title"in e&&(this.title=e.title),"languages"in e&&(this.languages=e.languages),"defaultLanguage"in e&&(this.defaultLanguage=e.defaultLanguage),t.emitUpdate(),this},i.prototype.addBuffer=function(n){var i=e.add(n).update({tab:this,language:this.getDefaultLanguage()});return this.buffers.push(i.id),t.emitUpdate(),i},i.prototype.getLanguages=function(){return this.languages?this.languages:this.tabset.getLanguages()},i.prototype.getDefaultLanguage=function(){return this.defaultLanguage?this.defaultLanguage:this.tabset.getDefaultLanguage()},i.prototype.getBuffer=function(t){var n=this.buffers[t||0];return n?e.get(n):n},i.prototype.focus=function(){var t=this.getBuffer();t&&t.focus()},i.prototype.dump=function(){return{title:this.title,buffers:_.map(this.buffers,function(t){var n=e.get(t);return n.pullFromControl(),[t,n.dump()]})}},i.prototype.load=function(e){return this.title=e.title,_.each(e.buffers,function(t){this.addBuffer(t[0]).load(t[1])}.bind(this)),t.emitUpdate(),this},i.prototype.clear=function(){this.title=null,_.each(this.buffers,function(t){e.remove(t)}),this.buffers=[],t.emitUpdate()},i.prototype.replayEvent=function(t){console.log("unhandled Tab event",t)},o}t.factory("FioiEditor2Tabs",e),e.$inject=["FioiEditor2Signals","FioiEditor2Buffers","FioiEditor2Recorder"]}},{}],12:[function(t,e,n){"use strict";e.exports=function(t){function e(t,e,n){function i(t){this.id=t,this.buffersPerTab=1,this.titlePrefix="Tab",this.languages=[{id:"text",label:"Text",ext:"txt"}],this.defaultLanguage="text",this.tabs={},this.tabIds=[],this.activeTabId=null}var o={},r={};return o.add=function(e){var o=n.freshId("ts",e),a=r[o]=new i(o);return n.register(o,a),t.emitUpdate(),a},o.get=function(t){return r[t]},o.find=function(t){return _.find(r,function(e,n){return e.name===t})},o.clear=function(){return _.each(r,function(t){t.clear()}),r={},t.emitUpdate(),this},o.dump=function(){return _.mapValues(r,function(t,e){return t.dump()})},o.load=function(e){return this.clear(),_.each(e,function(t,e){o.add(e).load(t)}),t.emitUpdate(),this},i.prototype.update=function(e){return"name"in e&&(this.name=e.name),"titlePrefix"in e&&(this.titlePrefix=e.titlePrefix),"languages"in e&&(this.languages=e.languages),"defaultLanguage"in e&&(this.defaultLanguage=e.defaultLanguage),"activeTabId"in e&&(this.activeTabId=e.activeTabId),t.emitUpdate(),this},i.prototype.addTab=function(n){var i=e.add(n).update({tabset:this,title:this._unusedTabTitle()});return n=i.id,this.tabs[n]=i,this.tabIds.push(n),null==this.activeTabId&&(this.activeTabId=n),t.emitUpdate(),i},i.prototype.removeTab=function(e){_.pull(this.tabIds,e),delete this.tabs[e],t.emitUpdate()},i.prototype.clear=function(){_.each(this.tabIds,function(t){e.remove(t)}),this.tabs={},this.tabIds=[],this.activeTabId=null,t.emitUpdate()},i.prototype.dump=function(){var t=this.tabs,e={tabs:_.map(this.tabIds,function(e){return[e,t[e].dump()]}),activeTab:this.activeTabId};return this.name&&(e.name=this.name),e},i.prototype.load=function(e){return e.name&&(this.name=e.name),_.each(e.tabs,function(t){this.addTab(t[0]).load(t[1])}.bind(this)),this.activeTab=e.activeTabId,t.emitUpdate(),this},i.prototype.getTabs=function(){var t=this.tabs;return _.map(this.tabIds,function(e){return t[e]})},i.prototype.getActiveTab=function(){return this.activeTabId&&this.tabs[this.activeTabId]},i.prototype.getLanguages=function(){return this.languages},i.prototype.getDefaultLanguage=function(){return this.defaultLanguage},i.prototype.focus=function(){var t=this.getActiveTab();t&&t.focus()},i.prototype.replayEvent=function(t){console.log("unhandled Tabset event",t)},i.prototype._unusedTabTitle=function(){var t=1,e={};for(_.each(this.tabs,function(t,n){e[t.title]=!0});;){var n=this.titlePrefix+t;if(!(n in e))return n;t+=1}},o}t.factory("FioiEditor2Tabsets",e),e.$inject=["FioiEditor2Signals","FioiEditor2Tabs","FioiEditor2Recorder"]}},{}]},{},[7]);
//# sourceMappingURL=fioi-editor2.min.js.map
